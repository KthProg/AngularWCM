function Issues(e, t) { e.filter = {}; e.showOpen = true; e.showClosed = true; e.openIssues = [{ Name: "Initializing" }]; e.closedIssues = [{ Name: "Initializing" }]; e.$on("filter", function (t, n) { $("select option:selected").each(function () { e.filter[$(this).parent().attr("name")] = $(this).text() }); e.getAllIssues() }); e.$on("export", function (t, n) { var r = "Open Issues\r\n"; r += e.objArrayToCSV(e.openIssues); r += "\r\nClosed Issues\r\n"; r += e.objArrayToCSV(e.closedIssues); var i = document.createElement("a"); i.setAttribute("href", "data:text/plain;charset=utf-8," + encodeURIComponent(r)); i.setAttribute("download", "SafetyIssues.csv"); i.click(); return r }); e.objArrayToCSV = function (e) { csv = ""; for (var t in e[0]) { if (e[0].hasOwnProperty(t)) { csv += t + "," } } csv = csv.substring(0, csv.length - 1); csv += "\r\n"; for (var n = 0, r = e.length; n < r; ++n) { for (var i in e[n]) { if (e[n].hasOwnProperty(i)) { csv += String(e[n][i]).replace(/(\r\n|\n|\r|,)/gm, "") + "," } } csv = csv.substring(0, csv.length - 1); csv += "\r\n" } return csv }; e.getAllIssues = function () { e.getIssues("GetOpenIssues", "openIssues"); e.getIssues("GetClosedIssues", "closedIssues") }; e.getIssues = function (n, r) { t.get("/scripts/php/Query.php?Query=" + n + "&ASSOC=true&Params=[]").success(function (t) { console.log(t); var n = e.formatResponse(t); var i = e.filterResponse(n); e[r] = i }) }; e.formatResponse = function (e) { for (var t = 0, n = e.length; t < n; ++t) { for (var r in e[t]) { if (!isNaN(e[t][r])) { e[t][r] = Number(e[t][r]) } } } return e }; e.filterResponse = function (t) { t = t.filter(function (t) { var n = true; for (var r in e.filter) { if (e.filter[r]) { if (t[r] == undefined || t[r] == e.filter[r]) { n = true } else { n = false; break } } } return n }); return t }; e.openIssue = function (n, r, i) { t.get("/scripts/php/Query.php?Query=OpenIssue&Params=" + JSON.stringify([n, r, i])).success(function (t) { e.getAllIssues() }) }; e.closeIssue = function (n, r, i) { var s = prompt("Enter in the action taken to close this issue."); if (s) { t.get("/scripts/php/Query.php?Query=CloseIssue&Params=" + JSON.stringify([n, r, i, s])).success(function (t) { e.getAllIssues() }) } else { alert("Action taken is invalid.") } }; e.getAllIssues() } app.controller("Issues", Issues)